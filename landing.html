<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeaD Archive - User Portal v61.0</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --main-orange: #FFA364; --text-black: #111; --text-grey: #666; --border-light: #eee; --bg-light: #f8f8f8; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { background-color: #ffffff; color: var(--text-black); overflow-x: hidden; padding-top: 60px; }
        .site-wrapper { max-width: 100%; margin: 0 auto; background-color: #fff; min-height: 100vh; position: relative; }
        .inner-container { max-width: 100%; margin: 0 auto; padding: 0 20px; }
        @media (min-width: 768px) { .inner-container { padding: 0 50px; } }

        /* --- [수정] 상단 메뉴: 가로 100% 및 로고 옆 메뉴 밀착 디자인 --- */
        .top-nav {
            position: fixed;
            top: 0; left: 0; 
            width: 100%; height: 60px;
            background-color: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #f0f0f0;
            z-index: 1000;
            display: flex; align-items: center;
        }
        .nav-content {
            width: 100%; 
            padding: 0 40px; 
            display: flex; 
            align-items: center; 
            justify-content: flex-start; /* 로고와 메뉴 왼쪽 정렬 */
            gap: 60px; /* 로고와 메뉴 사이 간격 */
        }
        .nav-logo { display: flex; align-items: center; gap: 8px; font-weight: 800; font-size: 18px; text-decoration: none; color: #1a1a1a; }
        .logo-icon { width: 24px; height: 24px; background: linear-gradient(135deg, #ff8a00, #ff5c00, #9c27b0); border-radius: 4px; }
        .nav-links { display: flex; gap: 30px; }
        .nav-links a { text-decoration: none; color: var(--text-grey); font-size: 15px; font-weight: 700; transition: color 0.2s; position: relative; }
        .nav-links a.active { color: #1a1a1a; }
        .nav-links a.active::after { content: ''; position: absolute; bottom: -20px; left: 0; width: 100%; height: 3px; background-color: #1a1a1a; }
        .nav-links a:hover { color: #ff5c00; }
        /* ----------------------------------------------------------- */

        .header-main { padding: 50px 0 20px; display: flex; flex-direction: column; gap: 20px; }
        @media (min-width: 768px) { .header-main { flex-direction: row; justify-content: space-between; align-items: center; } }
        .header-main h1 { font-size: 32px; font-weight: 800; letter-spacing: -1px; }
        .search-container { position: relative; width: 100%; max-width: 450px; }
        .search-container input { width: 100%; padding: 14px 45px 14px 20px; border: 1px solid #ddd; border-radius: 12px; background-color: var(--bg-light); outline: none; font-size: 14px; }
        .search-container i { position: absolute; right: 18px; top: 50%; transform: translateY(-50%); color: #aaa; }
        .tab-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; border-radius: 30px; border: 1px solid var(--border-light); background: #fff; font-size: 14px; font-weight: 600; color: #666; cursor: pointer; text-transform: uppercase; }
        .tab-btn.active { background-color: var(--main-orange); color: #fff; border-color: var(--main-orange); }
        .count-info { font-size: 14px; color: #333; margin-bottom: 30px; }
        .count-info b { color: var(--main-orange); }
        .landing-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; padding-bottom: 60px; justify-content: center; }
        .card { width: 100%; max-width: 430px; background: #fff; border-radius: 20px; overflow: hidden; border: 1px solid var(--border-light); cursor: pointer; transition: 0.3s; justify-self: center; }
        .card-thumb { position: relative; width: 100%; aspect-ratio: 430 / 232; background: #f9f9f9; overflow: hidden; }
        @media (min-width: 950px) { .landing-grid { grid-template-columns: repeat(2, 430px); } }
        @media (min-width: 1420px) { .landing-grid { grid-template-columns: repeat(3, 430px); } }
        @media (min-width: 1880px) { .landing-grid { grid-template-columns: repeat(4, 430px); } }
        @media (min-width: 2400px) { .landing-grid { grid-template-columns: repeat(5, 430px); } }
        
        .card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .card-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .card-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, transparent 40%, rgba(0,0,0,0.9) 100%); opacity: 0; transition: 0.3s; padding: 20px; display: flex; align-items: flex-end; justify-content: space-between; color: #fff; z-index: 5; }
        .card:hover .card-overlay { opacity: 1; }
        .ov-title { font-size: 13px; font-weight: 800; margin-bottom: 4px; }
        .ov-meta { font-size: 11px; color: rgba(255,255,255,0.7); }
        #modalOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(8px); padding: 0; }
        .modal-wrap { background: #fff; width: 100%; height: 100vh; display: flex; }
        .modal-container { background: #fff; margin: 0 auto; width: 1188px; height: 100%; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        @media (min-width: 1024px) { .modal-container { flex-direction: row; } }
        .modal-close { position: absolute; top: 20px; right: 20px; width: 44px; height: 44px; background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; cursor: pointer; z-index: 2100; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .modal-img-area { flex: 1; background: #F7F8F9; overflow-y: auto; display: flex; flex-direction: column; align-items: center; padding: 40px 20px; }
        .modal-img-list { width: 100%; background: #fff; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        .modal-img-list img { width: 100%; display: block; }
        .modal-img-list.is-pc-view { max-width: 884px; }
        .modal-img-list.is-mo-view { max-width: 430px; }
        .modal-info-area { width: 100%; padding: 40px 30px; border-top: 1px solid var(--border-light); background: #fff; flex-shrink: 0; }
        @media (min-width: 1024px) { .modal-info-area { width: 380px; border-top: none; border-left: 1px solid var(--border-light); height: 100%; overflow-y: auto; } }
        .info-box { border: 1px solid #eee; border-radius: 16px; padding: 25px; }
        .md-brand-txt { color: var(--main-orange); font-size: 13px; font-weight: 800; margin-bottom: 8px; display: block; }
        .md-title-big { font-size: 22px; font-weight: 800; margin-bottom: 25px; line-height: 1.4; color: #111; }
        .md-meta-info { margin-bottom: 30px; }
        .md-meta-info p { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 14px; color: #666; }
        .md-meta-info b { color: #111; }
        .md-device-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .md-device-btn { flex: 1; padding: 14px; border: 1px solid #eee; background: #fff; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; color: #aaa; }
        .md-device-btn.active { background: var(--main-orange); color: #fff; border-color: var(--main-orange); }
        .md-link-group { display: flex; gap: 10px; }
        .md-link-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px; padding: 14px; background: #f2f4f7; border-radius: 10px; text-decoration: none; color: #333; font-size: 13px; font-weight: 700; }
        .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 40px 0 80px; flex-wrap: wrap; }
        .page-num { background: none; border: none; font-size: 18px; font-weight: 500; color: #333; cursor: pointer; min-width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: 0.2s; }
        .page-num.active { background-color: var(--main-orange); color: #fff; }
    </style>
</head>
<body>

<div class="site-wrapper">
    <nav class="top-nav">
        <div class="nav-content">
            <a href="#" class="nav-logo">
                <div class="logo-icon"></div>
                WeaD Archive
            </a>
            <div class="nav-links">
                <a href="landing.html" class="active">랜딩페이지</a>
                <a href="banner.html">배너</a>
            </div>
        </div>
    </nav>

    <div class="inner-container">
        <div class="header-main">
            <h1>Archive</h1>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="페이지, 기획자, 디자이너 검색" onkeyup="handleSearch()">
                <i class="fas fa-search"></i>
            </div>
        </div>
        <div class="filter-section">
            <div class="tab-container" id="tabContainer"></div>
            <div class="count-info">결과: <b id="totalCount">0개</b></div>
        </div>
        <div id="grid" class="landing-grid"></div>
        <div id="pagination" class="pagination"></div>
    </div>

    <div id="modalOverlay" onclick="if(event.target === this) closeModal()">
        <div class="modal-wrap">
            <div class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></div>
            <div class="modal-container">
                <div class="modal-img-area" id="modalImgScroll">
                    <div class="modal-img-list" id="modalImgList"></div>
                </div>
                <div class="modal-info-area">
                    <div class="info-box">
                        <span id="mdBrand" class="md-brand-txt">BRAND</span>
                        <h2 id="mdTitle" class="md-title-big">TITLE</h2>
                        <div class="md-meta-info">
                            <p>기획 <span><b id="mdPlanner">-</b></span></p>
                            <p>디자인 <span><b id="mdDesigner">-</b></span></p>
                        </div>
                        <div class="md-device-group">
                            <button id="btnPC" class="md-device-btn" onclick="switchDevice('pc')">PC</button>
                            <button id="btnMO" class="md-device-btn" onclick="switchDevice('mo')">모바일</button>
                        </div>
                        <div class="md-link-group">
                            <a id="mdLiveBtn" href="#" target="_blank" class="md-link-btn"><i class="fas fa-external-link-alt"></i> 라이브</a>
                            <a id="mdFigmaBtn" href="#" target="_blank" class="md-link-btn"><i class="fas fa-file-signature"></i> 디자인 파일</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SUPABASE_URL = 'https://pfuwdbgnxkxcchjlwauc.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_GTnHAd2Q2wtlLjynoct2UA_r5RDvSPU';
    const BUCKET_NAME = 'landing';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

    let allItems = [], currentTab = 'all', currentPage = 1, itemsPerPage = 20, currentModalData = null;

    // [추가] 브랜드 영문-한글 매핑표
    const brandKoMap = {
        'viaggio': '비아지오',
        'nordkin': '노르드킨',
        'theweek': '더위크',
        'paper': '더위크',
        'japer': '더위크 일본어',
        'v6': 'V6',
        'hx5': 'HX5',
        'hlg': 'HLG'
    };

    // [추가] 한글 이름을 가져오는 도우미 함수
    const getKoName = (name) => {
        if(!name) return '';
        return brandKoMap[name.toLowerCase().trim()] || name.toUpperCase();
    };

    async function init() {
        const { data } = await supabaseClient.from('wead').select('*');
        if (data) {

            const pattern = /^[a-zA-Z0-9]+-\d+-\d+$/;
            allItems = data.filter(i => pattern.test(i.page_name));
            renderBrandTabs();
            applyFilters();
        }
    }

    function renderBrandTabs() {
        const container = document.getElementById('tabContainer');
        const brands = [...new Set(allItems.map(i => i.brand))].filter(Boolean).sort();
        let tabHtml = `<button class="tab-btn active" onclick="filterByTab('all', this)">전체</button>`;
        brands.forEach(brand => {
            // [수정] 버튼 텍스트에 한글 이름 적용
            tabHtml += `<button class="tab-btn" onclick="filterByTab('${brand}', this)">${getKoName(brand)}</button>`;
        });
        container.innerHTML = tabHtml;
    }

    function applyFilters() {
        let filtered = allItems;
        if (currentTab !== 'all') filtered = filtered.filter(i => i.brand === currentTab);
        const query = document.getElementById('searchInput').value.toLowerCase();
        if (query) {
            filtered = filtered.filter(i => 
                i.page_name.toLowerCase().includes(query) ||
                (i.content_text && i.content_text.toLowerCase().includes(query)) ||
                (i.designer && i.designer.toLowerCase().includes(query)) ||
                (i.planner && i.planner.toLowerCase().includes(query))
            );
        }

        filtered.sort((a, b) => {
            const isATheWeek = a.brand && a.brand.toLowerCase().trim() === 'theweek';
            const isBTheWeek = b.brand && b.brand.toLowerCase().trim() === 'theweek';
            if (isATheWeek && !isBTheWeek) return -1;
            if (!isATheWeek && isBTheWeek) return 1;
            return b.page_name.localeCompare(a.page_name, undefined, {numeric: true});
        });

        const unique = Array.from(new Map(filtered.map(i => [i.page_name, i])).values());
        document.getElementById('totalCount').innerText = `${unique.length}개`;
        const totalPages = Math.ceil(unique.length / itemsPerPage);
        renderGrid(unique.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage));
        renderPagination(totalPages);
    }

    function renderGrid(data) {
        const grid = document.getElementById('grid');
        grid.innerHTML = data.map(f => {
            const root = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET_NAME}/${f.brand}/${f.page_name}`;
            return `<div class="card" onclick="openModal('${f.page_name}')"><div class="card-thumb"><img src="${root}/pc/thum.jpg" onerror="this.onerror=function(){this.onerror=function(){this.src='https://via.placeholder.com/430x232?text=No+Image'};this.src='${root}/mo/01.jpg'};this.src='${root}/pc/01.jpg';"><div class="card-overlay"><div><div class="ov-title">${f.page_name.toUpperCase()}</div><div class="ov-meta">${f.planner || '-'} / ${f.designer || '-'}</div></div></div></div></div>`;
        }).join('');
    }

    function openModal(pageName) {
        const pcData = allItems.find(i => i.page_name === pageName && i.type === 'pc');
        const moData = allItems.find(i => i.page_name === pageName && i.type === 'mo');
        currentModalData = { pageName, pcData, moData };
        const base = pcData || moData;
        
        // [수정] 모달 브랜드 텍스트에 한글 이름 적용
        document.getElementById('mdBrand').innerText = getKoName(base.brand);
        document.getElementById('mdTitle').innerText = pageName;
        document.getElementById('mdPlanner').innerText = base.planner || '-';
        document.getElementById('mdDesigner').innerText = base.designer || '-';
        
        const figmaBtn = document.getElementById('mdFigmaBtn');
        if(base.file_key && base.file_key !== '-' && base.file_key !== '') {
            figmaBtn.href = `https://www.figma.com/file/${base.file_key}/?node-id=${base.id}`;
            figmaBtn.style.display = 'flex';
        } else {
            figmaBtn.style.display = 'none';
        }

        document.getElementById('modalOverlay').style.display = 'flex';
        switchDevice(pcData ? 'pc' : 'mo');
        document.body.style.overflow = 'hidden';
    }

    function switchDevice(type) {
        const list = document.getElementById('modalImgList'); 
        list.innerHTML = '';
        list.classList.remove('is-pc-view', 'is-mo-view');
        list.classList.add(type === 'pc' ? 'is-pc-view' : 'is-mo-view');
        const base = currentModalData.pcData || currentModalData.moData;
        for(let i=1; i<=25; i++) {
            const img = document.createElement('img');
            img.src = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET_NAME}/${base.brand}/${currentModalData.pageName}/${type}/${i.toString().padStart(2,'0')}.jpg`;
            img.onerror = function() { this.remove(); }; list.appendChild(img);
        }
        document.getElementById('btnPC').classList.toggle('active', type === 'pc');
        document.getElementById('btnMO').classList.toggle('active', type === 'mo');
        
        const liveUrl = getLiveUrl(currentModalData.pageName, type);
        const liveBtn = document.getElementById('mdLiveBtn');
        if(liveUrl) {
            liveBtn.href = liveUrl;
            liveBtn.style.display = 'flex';
        } else {
            liveBtn.style.display = 'none';
        }
        document.getElementById('modalImgScroll').scrollTop = 0;
    }

    function getLiveUrl(pageName, deviceType) {
        let name = pageName; 
        let upperName = pageName.toUpperCase();
        let domain = "";
        let path = (deviceType === 'pc') ? "/on_land/" : "/mo_land/";

        if (upperName.startsWith('V6-')) {
            domain = "https://bike.w-rental.co.kr/rental/Rental_V6";
            name = 'V6-' + name.split('-').slice(1).join('-');
        } else if (upperName.startsWith('HX5P-')) {
            domain = "https://bike.w-rental.co.kr/rental/Rental_HX5";
            name = 'HX5P-' + name.split('-').slice(1).join('-');
        } else if (upperName.startsWith('HLG-')) {
            domain = "https://health.nordkin.co.kr/health/TM_HLG";
            name = 'HLG-' + name.split('-').slice(1).join('-');
        } else if (upperName.startsWith('PAPER-')) {
            domain = "https://www.theweek.co.kr/edu/Rental_wcomms";
            name = 'Paper-' + name.split('-').slice(1).join('-') + '-01';
        } else {
            domain = "https://www.viaggio.co.kr";
        }

        return `${domain}${path}${name}.html`;
    }

    function renderPagination(total) {
        const pbox = document.getElementById('pagination'); pbox.innerHTML = '';
        if(total <= 1) return;
        for (let i = 1; i <= total; i++) {
            const btn = document.createElement('button');
            btn.className = `page-num ${i === currentPage ? 'active' : ''}`;
            btn.innerText = i;
            btn.onclick = () => { currentPage = i; applyFilters(); window.scrollTo(0, 0); };
            pbox.appendChild(btn);
        }
    }

    function filterByTab(tab, btn) { currentTab = tab; currentPage = 1; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); applyFilters(); }
    function handleSearch() { currentPage = 1; applyFilters(); }
    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; document.body.style.overflow = 'auto'; }
    init();
</script>
</body>
</html>

