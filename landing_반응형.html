<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeaD Archive - User Portal v60.6</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --main-orange: #FFA364;
            --text-black: #111;
            --text-grey: #666;
            --border-light: #eee;
            --bg-light: #f8f8f8;
        }

        /* Base Setup */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Pretendard', sans-serif; }
        body { background-color: #ffffff; color: var(--text-black); overflow-x: hidden; }

        .site-wrapper { max-width: 100%; margin: 0 auto; background-color: #fff; min-height: 100vh; position: relative; }
        .inner-container { max-width: 100%; margin: 0 auto; padding: 0 20px; }
        @media (min-width: 768px) { .inner-container { padding: 0 50px; } }

        /* Header */
        header { height: 70px; border-bottom: 1px solid var(--border-light); background: #fff; position: sticky; top: 0; z-index: 1000; }
        header .inner-container { display: flex; align-items: center; justify-content: space-between; height: 100%; }
        .logo { display: flex; align-items: center; font-size: 20px; font-weight: 900; letter-spacing: -0.5px; }
        .logo-icon { width: 22px; height: 22px; background: linear-gradient(135deg, #f3946a, #8e44ad); margin-right: 8px; border-radius: 4px; }
        .logo span { color: var(--main-orange); }
        .gnb-menu { display: flex; gap: 30px; }
        .gnb-menu a { text-decoration: none; color: var(--text-grey); font-size: 16px; font-weight: 700; height: 70px; display: flex; align-items: center; position: relative; }
        .gnb-menu a.active { color: var(--text-black); }
        .gnb-menu a.active::after { content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 3px; background-color: var(--text-black); }

        /* Content Header */
        .header-main { padding: 50px 0 20px; display: flex; flex-direction: column; gap: 20px; }
        @media (min-width: 768px) { .header-main { flex-direction: row; justify-content: space-between; align-items: center; } }
        .header-main h1 { font-size: 32px; font-weight: 800; letter-spacing: -1px; }
        .search-container { position: relative; width: 100%; max-width: 350px; }
        .search-container input { width: 100%; padding: 14px 45px 14px 20px; border: 1px solid #ddd; border-radius: 12px; background-color: var(--bg-light); outline: none; }
        .search-container i { position: absolute; right: 18px; top: 50%; transform: translateY(-50%); color: #aaa; }

        /* Tabs */
        .tab-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; border-radius: 30px; border: 1px solid var(--border-light); background: #fff; font-size: 14px; font-weight: 600; color: #666; cursor: pointer; }
        .tab-btn.active { background-color: var(--main-orange); color: #fff; border-color: var(--main-orange); }
        .count-info { font-size: 14px; color: #333; margin-bottom: 30px; }
        .count-info b { color: var(--main-orange); }

        /* Grid */
        .landing-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; padding-bottom: 60px; justify-content: center; }
        .card { width: 100%; max-width: 430px; background: #fff; border-radius: 20px; overflow: hidden; border: 1px solid var(--border-light); cursor: pointer; transition: 0.3s; justify-self: center; }
        .card-thumb { position: relative; width: 100%; aspect-ratio: 430 / 232; background: #f9f9f9; overflow: hidden; }
        @media (min-width: 950px) { .landing-grid { grid-template-columns: repeat(2, 430px); } }
        @media (min-width: 1420px) { .landing-grid { grid-template-columns: repeat(3, 430px); } }
        @media (min-width: 1880px) { .landing-grid { grid-template-columns: repeat(4, 430px); } }
        .card:hover { transform: translateY(-8px); box-shadow: 0 15px 30px rgba(0,0,0,0.1); }
        .card-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .card-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, transparent 40%, rgba(0,0,0,0.9) 100%); opacity: 0; transition: 0.3s; padding: 20px; display: flex; align-items: flex-end; justify-content: space-between; color: #fff; }
        .card:hover .card-overlay { opacity: 1; }

        /* --- Modal Area --- */
        #modalOverlay { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #f7f7f7; z-index: 2000; justify-content: center; align-items: center; 
        }
        .modal-container { width: 100%; height: 100vh; display: flex; justify-content: center; position: relative; }
        .modal-wrap { display: flex; width: 100%; max-width: 1400px; height: 100%; position: relative; }

        /* Left: Image Area (Centered) */
        .modal-img-area { 
            flex: 1; height: 100%; overflow-y: auto; display: flex; flex-direction: column; 
            align-items: center; padding: 60px 20px; scrollbar-width: none; 
        }
        .modal-img-area::-webkit-scrollbar { display: none; }
        
        .modal-img-list { 
            width: 100%; background: #fff; box-shadow: 0 10px 40px rgba(0,0,0,0.05); 
            transition: max-width 0.3s ease-in-out; 
        }
        /* [너비 조건 반영] */
        .modal-img-list.is-pc-view { max-width: 884px; }
        .modal-img-list.is-mo-view { max-width: 430px; }
        .modal-img-list img { width: 100%; display: block; }

        /* Right: Info Area (Sticky) */
        .modal-info-area { width: 340px; padding: 60px 20px; position: sticky; top: 0; height: fit-content; }
        .info-box { background: #fff; border-radius: 12px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; }
        
        .modal-close { position: fixed; top: 30px; right: 40px; font-size: 24px; color: #999; cursor: pointer; z-index: 2200; }

        /* Typography & Buttons */
        .md-brand-txt { color: var(--main-orange); font-size: 12px; font-weight: 700; margin-bottom: 4px; display: block; }
        .md-title-big { font-size: 18px; font-weight: 800; margin-bottom: 20px; line-height: 1.4; color: #333; }
        .md-meta-info { margin-bottom: 20px; border-top: 1px solid #f5f5f5; padding-top: 15px; }
        .md-meta-info p { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 13px; color: #888; }
        .md-meta-info p span { font-weight: 600; color: #444; }
        .md-device-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 15px; }
        .md-device-btn { width: 100%; padding: 12px; border: 1px solid #eee; background: #fff; border-radius: 6px; font-weight: 600; font-size: 12px; cursor: pointer; color: #ccc; }
        .md-device-btn.active { background: #FFA364; color: #fff; border-color: #FFA364; }
        .md-link-group { display: flex; gap: 8px; }
        .md-link-btn { flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px; padding: 10px; background: #f8f9fa; border-radius: 6px; text-decoration: none; color: #333; font-size: 11px; font-weight: 600; border: 1px solid #eee; }

        /* Pagination */
        .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 40px 0 80px; }
        .page-num { background: none; border: none; font-size: 18px; font-weight: 500; cursor: pointer; min-width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .page-num.active { background-color: var(--main-orange); color: #fff; }
    </style>
</head>
<body>

<div class="site-wrapper">
    <header>
        <div class="inner-container">
            <div class="logo"><div class="logo-icon"></div>WeaD <span>Archive</span></div>
            <nav class="gnb-menu"><a href="#" class="active">랜딩페이지</a><a href="#">배너</a></nav>
        </div>
    </header>

    <div class="inner-container">
        <div class="header-main">
            <h1>Archive</h1>
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="페이지명 또는 키워드 검색" onkeyup="handleSearch()">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <div class="filter-section">
            <div class="tab-container" id="tabContainer">
                <button class="tab-btn active" onclick="filterByTab('all', this)">전체</button>
                <button class="tab-btn" onclick="filterByTab('viaggio', this)">비아지오</button>
                <button class="tab-btn" onclick="filterByTab('nordkin', this)">노르드킨</button>
            </div>
            <div class="count-info">결과: <b id="totalCount">0개</b></div>
        </div>

        <div class="main-content">
            <div id="grid" class="landing-grid"></div>
            <div id="pagination" class="pagination"></div>
        </div>
    </div>

    <div id="modalOverlay" onclick="if(event.target === this) closeModal()">
        <div class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></div>
        <div class="modal-container">
            <div class="modal-wrap">
                <div class="modal-img-area" id="modalImgScroll">
                    <div class="modal-img-list" id="modalImgList"></div>
                </div>
                
                <div class="modal-info-area">
                    <div class="info-box">
                        <span id="mdBrand" class="md-brand-txt">BRAND</span>
                        <h2 id="mdTitle" class="md-title-big">TITLE</h2>
                        <div class="md-meta-info">
                            <p>기획 <span id="mdPlanner">-</span></p>
                            <p>디자인 <span id="mdDesigner">-</span></p>
                        </div>
                        <div class="md-device-group">
                            <button id="btnPC" class="md-device-btn" onclick="switchDevice('pc')">PC</button>
                            <button id="btnMO" class="md-device-btn" onclick="switchDevice('mo')">모바일</button>
                        </div>
                        <div class="md-link-group">
                            <a id="mdLiveBtn" href="#" target="_blank" class="md-link-btn"><i class="fas fa-globe"></i> 라이브</a>
                            <a id="mdFigmaBtn" href="#" target="_blank" class="md-link-btn"><i class="fas fa-file-signature"></i> 디자인 파일</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const SUPABASE_URL = 'https://pfuwdbgnxkxcchjlwauc.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_GTnHAd2Q2wtlLjynoct2UA_r5RDvSPU';
    const BUCKET_NAME = 'landing';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

    let allItems = [], currentTab = 'all', currentPage = 1, itemsPerPage = 20, currentModalData = null;

    async function init() {
        const { data } = await supabaseClient.from('wead').select('*');
        if (data) {
            const pattern = /^[a-zA-Z0-9]+-\d{1,2}-\d{1,2}$/;
            allItems = data.filter(i => pattern.test(i.page_name));
            applyFilters();
        }
    }

    function applyFilters() {
        let filtered = allItems;
        if (currentTab !== 'all') filtered = filtered.filter(i => i.brand === currentTab);
        const query = document.getElementById('searchInput').value.toLowerCase();
        if (query) filtered = filtered.filter(i => i.page_name.toLowerCase().includes(query));
        filtered.sort((a, b) => b.page_name.localeCompare(a.page_name, undefined, {numeric: true}));
        const unique = Array.from(new Map(filtered.map(i => [i.page_name, i])).values());
        document.getElementById('totalCount').innerText = `${unique.length}개`;
        const totalPages = Math.ceil(unique.length / itemsPerPage);
        renderGrid(unique.slice((currentPage - 1) * itemsPerPage, currentPage * itemsPerPage));
        renderPagination(totalPages);
    }

    function renderGrid(data) {
        const grid = document.getElementById('grid');
        grid.innerHTML = data.map(f => {
            const root = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET_NAME}/${f.brand}/${f.page_name}`;
            return `<div class="card" onclick="openModal('${f.page_name}')"><div class="card-thumb"><img src="${root}/pc/thum.jpg" onerror="this.src='${root}/mo/thum.jpg'"><div class="card-overlay"><div><div class="ov-title">${f.page_name.toUpperCase()}</div><div class="ov-meta">${f.planner || '-'} / ${f.designer || '-'}</div></div></div></div></div>`;
        }).join('');
    }

    function openModal(pageName) {
        const pcData = allItems.find(i => i.page_name === pageName && i.type === 'pc');
        const moData = allItems.find(i => i.page_name === pageName && i.type === 'mo');
        currentModalData = { pageName, pcData, moData };
        const base = pcData || moData;
        document.getElementById('mdBrand').innerText = base.brand.toUpperCase();
        document.getElementById('mdTitle').innerText = pageName.toUpperCase();
        document.getElementById('mdPlanner').innerText = base.planner || '-';
        document.getElementById('mdDesigner').innerText = base.designer || '-';
        document.getElementById('mdFigmaBtn').href = `https://www.figma.com/file/${base.file_key}/?node-id=${base.id}`;
        document.getElementById('btnPC').style.display = pcData ? 'block' : 'none';
        document.getElementById('btnMO').style.display = moData ? 'block' : 'none';
        document.getElementById('modalOverlay').style.display = 'flex';
        switchDevice(pcData ? 'pc' : 'mo');
        document.body.style.overflow = 'hidden';
    }

    /* [수정된 스위치 디바이스 함수] */
    function switchDevice(type) {
        const list = document.getElementById('modalImgList'); 
        list.innerHTML = '';
        
        // 너비 클래스 토글
        list.classList.remove('is-pc-view', 'is-mo-view');
        list.classList.add(type === 'pc' ? 'is-pc-view' : 'is-mo-view');

        const base = currentModalData.pcData || currentModalData.moData;
        for(let i=1; i<=20; i++) {
            const img = document.createElement('img');
            img.src = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET_NAME}/${base.brand}/${currentModalData.pageName}/${type}/${i.toString().padStart(2,'0')}.jpg`;
            img.onerror = function() { this.remove(); }; list.appendChild(img);
        }
        document.getElementById('btnPC').classList.toggle('active', type === 'pc');
        document.getElementById('btnMO').classList.toggle('active', type === 'mo');
        document.getElementById('mdLiveBtn').href = getLiveUrl(currentModalData.pageName, type);
        document.getElementById('modalImgScroll').scrollTop = 0;
    }

    function getLiveUrl(pageName, deviceType) {
        let name = pageName.toUpperCase();
        let domain = "https://www.viaggio.co.kr";
        let path = (deviceType === 'pc') ? "/on_land/" : "/mo_land/";
        if (name.startsWith('V6-')) domain = "https://bike.w-rental.co.kr/rental/Rental_V6";
        else if (name.startsWith('HX5P-')) domain = "https://bike.w-rental.co.kr/rental/Rental_HX5";
        else if (name.startsWith('HLG-')) domain = "https://health.nordkin.co.kr/health/TM_HLG";
        return `${domain}${path}${name}.html`;
    }

    function renderPagination(total) {
        const pbox = document.getElementById('pagination'); pbox.innerHTML = '';
        if(total <= 1) return;
        for (let i = 1; i <= total; i++) {
            const btn = document.createElement('button');
            btn.className = `page-num ${i === currentPage ? 'active' : ''}`;
            btn.innerText = i;
            btn.onclick = () => { currentPage = i; applyFilters(); window.scrollTo(0, 0); };
            pbox.appendChild(btn);
        }
    }

    function filterByTab(tab, btn) { currentTab = tab; currentPage = 1; document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); applyFilters(); }
    function handleSearch() { currentPage = 1; applyFilters(); }
    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; document.body.style.overflow = 'auto'; }
    init();
</script>
</body>
</html>
